<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AutoSolar Map</title>

  <!-- Leaflet -->
  <link rel="stylesheet"
        href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
        crossorigin="anonymous">
  <style>
    html, body { height: 100%; margin: 0; }
    .app { display:flex; height:100%; }

    /* ì¢Œì¸¡ ì–‡ì€ ì•„ì´ì½˜ ë°” */
    .iconbar {
      width: 56px; background:#f3f4f6; border-right:1px solid #e5e7eb;
      display:flex; flex-direction:column; align-items:center; padding:10px 8px; gap:18px;
    }
    .icon { width:36px; height:36px; border-radius:12px; display:grid; place-items:center;
            font-size:20px; cursor:default; user-select:none; }
    .icon.active { outline:2px solid #2563eb22; background:#ffffff; }

    /* ì‚¬ì´ë“œë°”(ê²€ìƒ‰ íŒ¨ë„) */
    .sidebar {
      width: 300px; background:#ffffff; border-right:1px solid #e5e7eb;
      padding:16px; display:flex; flex-direction:column; gap:12px;
    }
    .logo { font-weight:800; letter-spacing:.5px; margin-bottom:8px; }
    .search-box { display:flex; gap:8px; }
    .search-box input {
      flex:1; padding:10px 12px; border-radius:10px; border:1px solid #d1d5db;
      outline:none;
    }
    .search-box button {
      padding:10px 14px; border:none; border-radius:10px; background:#2563eb; color:#fff; font-weight:700; cursor:pointer;
    }
    .hint { font-size:12px; color:#6b7280; }
    #map { flex:1; }

    /* ë ˆì´ì•„ì›ƒ */
    .content { flex:1; display:flex; }
  </style>
</head>
<body>
<div class="app">
  <!-- ì¢Œì¸¡ ì•„ì´ì½˜ ë°” (ë™ì‘ì€ ì•„ì§ ì—†ìŒ, UI ê³¨ê²©ë§Œ) -->
  <aside class="iconbar">
    <div class="icon active" title="ê²€ìƒ‰">ğŸ”</div>
    <div class="icon" title="ë ˆì´ì–´">ğŸ§±</div>
    <div class="icon" title="í”„ë¡œì íŠ¸">ğŸ“„</div>
    <div class="icon" title="DB">ğŸ“</div>
    <div style="margin-top:auto;"></div>
    <div class="icon" title="ì‚¬ìš©ì">ğŸ‘¤</div>
  </aside>

  <!-- ê²€ìƒ‰ íŒ¨ë„ -->
  <aside class="sidebar">
    <div class="logo">autosolar</div>
    <div>
      <div style="font-size:12px; color:#9ca3af; text-transform:uppercase; margin-bottom:6px;">ì§€ì—­ ê²€ìƒ‰</div>
      <form id="search-form" class="search-box">
        <input id="address-input" type="text" placeholder="ì˜ˆ) ì¶©ë¶ ì¶©ì£¼ì‹œ ê¸ˆê°€ë©´ 123" />
        <button type="submit">ê²€ìƒ‰</button>
      </form>
      <div class="hint">ì£¼ì†Œ ì…ë ¥ â†’ Vworld ì§€ì˜¤ì½”ë”© â†’ ì§€ë„ Zoom in</div>
    </div>
    <!-- (í–¥í›„) ë ˆì´ì–´/í•„í„° ìë¦¬ -->
  </aside>

  <!-- ì§€ë„ -->
  <div class="content">
    <div id="map"></div>
  </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
        crossorigin="anonymous"></script>
        <script>
          const map = L.map('map').setView([36.5, 127.8], 8);
          L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19, attribution: '&copy; OpenStreetMap'
          }).addTo(map);
        
          let marker;
        
          document.getElementById('search-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const q = document.getElementById('address-input').value.trim();
            if (!q) { alert('ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”.'); return; }
        
            try {
              const res = await fetch(`/search_address/?q=${encodeURIComponent(q)}`);
              const data = await res.json();
        
              if (!res.ok) {
                // ë°±ì—”ë“œê°€ ë„˜ê²¨ì¤€ ìƒì„¸ ì—ëŸ¬ë¥¼ ë³´ì—¬ì£¼ì
                const msg = data?.error || 'unknown_error';
                const prov = data?.provider ? `\n[provider] ${JSON.stringify(data.provider)}` : '';
                const detail = data?.detail ? `\n[detail] ${data.detail}` : '';
                alert(`ê²€ìƒ‰ ì‹¤íŒ¨: ${msg}${prov}${detail}`);
                return;
              }
        
              const { x, y, label } = data;
              if (marker) map.removeLayer(marker);
              marker = L.marker([y, x]).addTo(map).bindPopup(label || q).openPopup();
              map.setView([y, x], 16);
            } catch (err) {
              console.error(err);
              alert('ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
          });
        </script>
        
</body>
</html>