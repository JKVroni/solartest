<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AutoSolar Map</title>

  <!-- Leaflet -->
  <link rel="stylesheet"
        href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
        crossorigin="anonymous">
  <style>
    html, body { height: 100%; margin: 0; }
    .app { display:flex; height:100%; }

    /* 좌측 얇은 아이콘 바 */
    .iconbar {
      width: 56px; background:#f3f4f6; border-right:1px solid #e5e7eb;
      display:flex; flex-direction:column; align-items:center; padding:10px 8px; gap:18px;
    }
    .icon { width:36px; height:36px; border-radius:12px; display:grid; place-items:center;
            font-size:20px; cursor:default; user-select:none; }
    .icon.active { outline:2px solid #2563eb22; background:#ffffff; }

    /* 사이드바(검색 패널) */
    .sidebar {
      width: 300px; background:#ffffff; border-right:1px solid #e5e7eb;
      padding:16px; display:flex; flex-direction:column; gap:12px;
    }
    .logo { font-weight:800; letter-spacing:.5px; margin-bottom:8px; }
    .search-box { display:flex; gap:8px; }
    .search-box input {
      flex:1; padding:10px 12px; border-radius:10px; border:1px solid #d1d5db;
      outline:none;
    }
    .search-box button {
      padding:10px 14px; border:none; border-radius:10px; background:#2563eb; color:#fff; font-weight:700; cursor:pointer;
    }
    .hint { font-size:12px; color:#6b7280; }
    #map { flex:1; }

    /* 레이아웃 */
    .content { flex:1; display:flex; }
  </style>
</head>
<body>
<div class="app">
  <!-- 좌측 아이콘 바 (동작은 아직 없음, UI 골격만) -->
  <aside class="iconbar">
    <div class="icon active" title="검색">🔍</div>
    <div class="icon" title="레이어">🧱</div>
    <div class="icon" title="프로젝트">📄</div>
    <div class="icon" title="DB">📁</div>
    <div style="margin-top:auto;"></div>
    <div class="icon" title="사용자">👤</div>
  </aside>

  <!-- 검색 패널 -->
  <aside class="sidebar">
    <div class="logo">autosolar</div>
    <div>
      <div style="font-size:12px; color:#9ca3af; text-transform:uppercase; margin-bottom:6px;">지역 검색</div>
      <form id="search-form" class="search-box">
        <input id="address-input" type="text" placeholder="예) 충북 충주시 금가면 123" />
        <button type="submit">검색</button>
      </form>
      <div class="hint">주소 입력 → Vworld 지오코딩 → 지도 Zoom in</div>
    </div>
    <!-- (향후) 레이어/필터 자리 -->
  </aside>

  <!-- 지도 -->
  <div class="content">
    <div id="map"></div>
  </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
        crossorigin="anonymous"></script>
        <script>
          const map = L.map('map').setView([36.5, 127.8], 8);
          L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19, attribution: '&copy; OpenStreetMap'
          }).addTo(map);
        
          let marker;
        
          document.getElementById('search-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const q = document.getElementById('address-input').value.trim();
            if (!q) { alert('주소를 입력하세요.'); return; }
        
            try {
              const res = await fetch(`/search_address/?q=${encodeURIComponent(q)}`);
              const data = await res.json();
        
              if (!res.ok) {
                // 백엔드가 넘겨준 상세 에러를 보여주자
                const msg = data?.error || 'unknown_error';
                const prov = data?.provider ? `\n[provider] ${JSON.stringify(data.provider)}` : '';
                const detail = data?.detail ? `\n[detail] ${data.detail}` : '';
                alert(`검색 실패: ${msg}${prov}${detail}`);
                return;
              }
        
              const { x, y, label } = data;
              if (marker) map.removeLayer(marker);
              marker = L.marker([y, x]).addTo(map).bindPopup(label || q).openPopup();
              map.setView([y, x], 16);
            } catch (err) {
              console.error(err);
              alert('검색 중 오류가 발생했습니다.');
            }
          });
        </script>
        
</body>
</html>